<!doctype html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;1,100&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
    <!-- ESTILOS PROPIOS -->
    <link rel="stylesheet" href="/styles/main.css">
    <title>index</title>
  </head>

  <body>

    <%- include('../views/header'); %>
    
      <!-- CUERPO DE PAGINA -->

      <div id="carouselExampleInterval" class="carousel slide shadow" data-ride="carousel">
        <div class="carousel-inner" style="height: 320px; margin-top: 70px;">
          <div class="carousel-item active" data-interval="4000">
            <img src="/images/c1.jpg" class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item" data-interval="4000">
            <img src="/images/c2.jpg" class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item" data-interval="4000">
            <img src="/images/c3.jpg" class="d-block w-100" alt="...">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-target="#carouselExampleInterval" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-target="#carouselExampleInterval" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </button>
      </div>

      <div class="descu">
        <p>Â¡GRANDES DESCUENTOS!</p>
        
      </div>
      
    <!-- PRODUCTOS POR CATEGORIA -->

    <h3 class="subtitulos">Productos por tipo:</h3>
    <p class="titulo-tipo"> Fibra</p>
    <div class="Productos-categoria" style="text-align: center;">
      <% produc.forEach(function(prod) { %>
        <% if (prod.tipo === "fibra") { %>
          <div class="card shadow" style="width: 18rem;">
            <img src="https://source.unsplash.com/300x400/?<%=prod.descripcion%>" class="card-img-top" style="height: 300px;" alt="...">
            <div class="card-body">
              <h5 class="card-title"><%=prod.descripcion%></h5>
              <p class="card-text">Precio: <%=prod.valor%></p>
              <p class="card-text">Disponibilidad: <%=prod.stock%></p>
              <p class="card-text">Tipo: <%=prod.tipo%></p>
              <a onclick="agregarCarrito('<%=prod._id%>','<%=prod.descripcion%>','<%=prod.valor%>','<%=prod.stock%>')" class="btn btn-primary">Agregar al carrito</a>
            </div>
          </div>
        <% } %>
      <% }); %>
    </div>

    <p class="titulo-tipo"> Madera</p>
    <div class="Productos-categoria" style="text-align: center;">
      <% produc.forEach(function(prod) { %>
        <% if (prod.tipo === "madera") { %>
          <div class="card shadow" style="width: 18rem;">
            <img src="https://source.unsplash.com/300x400/?<%=prod.descripcion%>" class="card-img-top" style="height: 300px;" alt="...">
            <div class="card-body">
              <h5 class="card-title"><%=prod.descripcion%></h5>
              <p class="card-text">Precio: <%=prod.valor%></p>
              <p class="card-text">Disponibilidad: <%=prod.stock%></p>
              <p class="card-text">Tipo: <%=prod.tipo%></p>
              <a onclick="agregarCarrito('<%=prod._id%>','<%=prod.descripcion%>','<%=prod.valor%>','<%=prod.stock%>')" class="btn btn-primary">Agregar al carrito</a>
            </div>
          </div>
          <% } %>
        <% }); %>
    </div>

    <p class="titulo-tipo"> Tela</p>
    <div class="Productos-categoria" style="text-align: center;">
      <% produc.forEach(function(prod) { %>
        <% if (prod.tipo === "tela") { %>
          <div class="card shadow" style="width: 18rem;">
            <img src="https://source.unsplash.com/300x400/?<%=prod.descripcion%>" class="card-img-top" style="height: 300px;" alt="...">
            <div class="card-body">
              <h5 class="card-title"><%=prod.descripcion%></h5>
              <p class="card-text">Precio: <%=prod.valor%></p>
              <p class="card-text">Disponibilidad: <%=prod.stock%></p>
              <p class="card-text">Tipo: <%=prod.tipo%></p>
              <a onclick="agregarCarrito('<%=prod._id%>','<%=prod.descripcion%>','<%=prod.valor%>','<%=prod.stock%>')" class="btn btn-primary">Agregar al carrito</a>
            </div>
          </div>
          <% } %>
        <% }); %>
    </div>

    <p class="titulo-tipo"> Retaso</p>
    <div class="Productos-categoria" style="text-align: center;">
      <% produc.forEach(function(prod) { %>
        <% if (prod.tipo === "retaso") { %>
          <div class="card shadow" style="width: 18rem;">
            <img src="https://source.unsplash.com/300x400/?<%=prod.descripcion%>" class="card-img-top" style="height: 300px;" alt="...">
            <div class="card-body">
              <h5 class="card-title"><%=prod.descripcion%></h5>
              <p class="card-text">Precio: <%=prod.valor%></p>
              <p class="card-text">Disponibilidad: <%=prod.stock%></p>
              <p class="card-text">Tipo: <%=prod.tipo%></p>
              <a onclick="agregarCarrito('<%=prod._id%>','<%=prod.descripcion%>','<%=prod.valor%>','<%=prod.stock%>')" class="btn btn-primary">Agregar al carrito</a>
            </div>
          </div>
          <% } %>
        <% }); %>
    </div>

    <h3 class="subtitulos">Productos mas vendidos</h3>
    <div class="masvendidos">
        <div class="card mb-3 shadow" style="width: 500px;">
            <div class="row no-gutters">
                <div class="col-md-4">
                    <img src="/images/c2.jpg" style="width: 270px; height: 250px;" alt="...">
                </div>
                <div class="col-md-8">
                    <div class="card-body" style="text-align: right;">
                        <h5 class="card-title">Escobas</h5>
                        <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                        <a href="#" class="btn btn-outline-primary">Agregar al carrito</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-3 shadow" style="width: 500px;">
            <div class="row no-gutters">
                <div class="col-md-4">
                    <img src="/images/c2.jpg" style="width: 270px; height: 250px;" alt="...">
                </div>
                <div class="col-md-8">
                    <div class="card-body" style="text-align: right;">
                        <h5 class="card-title">Escobas</h5>
                        <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                        <a href="#" class="btn btn-outline-primary">Agregar al carrito</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-3 shadow" style="width: 500px;">
            <div class="row no-gutters">
                <div class="col-md-4">
                    <img src="/images/c2.jpg" style="width: 270px; height: 250px;" alt="...">
                </div>
                <div class="col-md-8">
                    <div class="card-body" style="text-align: right;">
                        <h5 class="card-title">Escobas</h5>
                        <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                        <a href="#" class="btn btn-outline-primary">Agregar al carrito</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-3 shadow" style="width: 500px; margin-bottom: 20px;">
            <div class="row no-gutters">
            <div class="col-md-4">
                <img src="/images/c3.jpg" style="width: 270px; height: 250px;" alt="...">
            </div>
            <div class="col-md-8">
                <div class="card-body" style="text-align: right;">
                    <h5 class="card-title">Traperas</h5>
                    <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                    <a href="#" class="btn btn-outline-primary">Agregar al carrito</a>
                </div>
            </div>
            </div>
        </div>
        <div class="card mb-3 shadow" style="width: 500px;">
          <div class="row no-gutters">
          <div class="col-md-4">
              <img src="/images/c3.jpg" style="width: 270px; height: 250px;" alt="...">
          </div>
          <div class="col-md-8">
              <div class="card-body" style="text-align: right;">
                  <h5 class="card-title">Traperas</h5>
                  <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                  <a href="#" class="btn btn-outline-primary">Agregar al carrito</a>
              </div>
          </div>
          </div>
      </div> 
    </div>
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
      <div class="offcanvas-header">
        <h5 id="offcanvasRightLabel">Carrito</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
    <div class="offcanvas-body">
      <div id="container-carrito">
      </div>
      <div class="offcanvas-footer">
        <!-- <button type="button" class="btn btn-success">Comprar</button> -->
        <!-- <a class="btn btn-success" role="button" href="/procesarCompra">Comprar</a> -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
          Comprar
        </button>
        <span id="totalPrice"></span>
      </div>
    </div>
  </div>

    <!-- FOOTER  -->

    <footer>
      <%- include('../views/footer'); %>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
    <script>
        var carrito = JSON.parse(localStorage.getItem("carrito")) || [];
  
  function agregarCarrito(id,name,pricePro,image) {
    let productoagregado ={
      "id":id,
      "nombre":name,
      "precio":pricePro,
      "Image":image,
      "cantidad": 0
    }
    //function logica que guarde los objetos
    //El boton  Carrito debe llamar una funcion que:
    //1. leer si hay una cookie..analizar si hay objetos repetidos entre la coockie y el array.
    //2. pintar el offcanvas con los objetos encontrados en el carrito
    let counter = 0;
    let carritoF = carrito.filter(element => element.id === id)
    if (carritoF.length > 0) {
      console.log(carritoF)
      carritoF[0].cantidad = carritoF[0].cantidad + 1;
      mostrarCarrito();
    } else {
      carrito.push(productoagregado);
    }

    saveLocal()
    mostrarCarrito();
  }
  
  const mostrarCarrito = () => {
    const container = document.getElementById('container-carrito');

    container.innerHTML ="";
    //cardlist.innerHTML= "";console
    carrito.forEach(element => {
      const idPro = document.getElementById('idProdu')

      const cardlist = document.createElement('div');
      cardlist.setAttribute('class','listaCarrito')

      const imagen = document.createElement('img')
      const nombrePro = document.createElement('p')
      const price = document.createElement('p')
      const doc = document.createElement('p')
      const eliminar = document.createElement('span');
      const cantidad = document.createElement('span');
      cantidad.setAttribute('class','cantidad-carrito');

      // cardlist.appendChild(doc)
      cardlist.appendChild(imagen)
      cardlist.appendChild(nombrePro)
      cardlist.appendChild(price)
      cardlist.appendChild(eliminar)  
      cardlist.appendChild(cantidad)   

      eliminar.innerText = 'x'
      eliminar.className = 'eliminar-producto'
      // doc.textContent = id;
      imagen.src = 'https://source.unsplash.com/300x400/?nombre';
      nombrePro.textContent = element.nombre;
      price.textContent = element.precio;
      cantidad.textContent = element.cantidad
      eliminar.addEventListener("click" , () => {
        eliminarPro(element.id);
      })


      container.appendChild(cardlist)
    });
  }

  const eliminarPro = (id) => {
    carrito = carrito.filter((element) => element.id !== id)
    saveLocal();
    mostrarCarrito();
  }

  const saveLocal = () => {
    localStorage.setItem("carrito", JSON.stringify(carrito));
  };

  const carritoCounter = () => {
    cantidadCarrito.style.display = "block";
    const carritoLength = carrito.length;
    localStorage.setItem("carritoLength", JSON.stringify(carritoLength));
    cantidadCarrito.innerText = JSON.parse(localStorage.getItem("carritoLength"));
  };
    </script>
  </body>
</html>